---
import { getCollection } from "astro:content";
import ChapterLayout from "@/layouts/ChapterLayout.astro";
import { sortChapters, toChapterParam, toChapterUrl, toVolumeParam } from "@/lib/novel";

export async function getStaticPaths() {
  const chapters = (await getCollection("novel")).sort(sortChapters);

  return chapters.map((entry, index) => {
    const prev = chapters[index - 1];
    const next = chapters[index + 1];

    return {
      params: {
        volume: toVolumeParam(entry.data.volume),
        chapter: toChapterParam(entry.data.chapter),
      },
      props: {
        entry,
        prev: prev
          ? {
              title: prev.data.title,
              href: toChapterUrl(prev),
            }
          : undefined,
        next: next
          ? {
              title: next.data.title,
              href: toChapterUrl(next),
            }
          : undefined,
      },
    };
  });
}

const { entry, prev, next } = Astro.props;
const { Content } = await entry.render();
---

<ChapterLayout title={entry.data.title} description={entry.data.summary} prev={prev} next={next}>
  <Content />
</ChapterLayout>
