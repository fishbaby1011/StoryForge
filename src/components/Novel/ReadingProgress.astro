<div
  id="restore-toast"
  class="fixed right-4 top-4 z-30 hidden rounded-lg border border-amber-900/15 bg-paper px-4 py-2 text-sm shadow-lg"
>
  Restored reading position
  <button id="restore-cancel" class="ml-3 text-accent underline">Cancel</button>
</div>

<script is:inline>
  const scrollKey = `novel:scroll:${location.pathname}`;
  const pathKey = "novel:lastPath";
  const toast = document.getElementById("restore-toast");
  const cancel = document.getElementById("restore-cancel");

  const saved = localStorage.getItem(scrollKey);
  if (saved) {
    const y = Number(saved);
    if (!Number.isNaN(y)) {
      requestAnimationFrame(() => window.scrollTo({ top: y, behavior: "auto" }));
      toast?.classList.remove("hidden");
      setTimeout(() => toast?.classList.add("hidden"), 2500);
    }
  }

  cancel?.addEventListener("click", () => {
    localStorage.removeItem(scrollKey);
    window.scrollTo({ top: 0, behavior: "smooth" });
    toast?.classList.add("hidden");
  });

  const persist = () => {
    localStorage.setItem(scrollKey, String(window.scrollY));
    localStorage.setItem(pathKey, location.pathname);
  };

  window.addEventListener("scroll", persist, { passive: true });
  window.addEventListener("beforeunload", persist);
</script>
